# Dédalo — Copilot instructions for code contributions

This file gives focused, actionable guidance for AI coding agents working in this repository. Keep instructions concise and follow the repository's patterns and runtime constraints.

Core pointers
- **Project type:** PHP web application (Dédalo CMS) using a runtime-driven ontology model. Main PHP code lives under `core/` and `code/`.
- **DB model:** Primary storage uses PostgreSQL with JSONB payloads. Many objects are built at runtime from the ontology rather than static PHP classes.
- **Config files:** Development copies live `config/sample.*.php` → `config/*.php` (e.g. `sample.config.php` → `config.php`). Do not edit `sample.*` files directly; edit copies in `config/`.

Where to look for patterns (examples)
- **Components:** Look at `core/component_*` directories for component conventions (init files, templates, naming). Use these as a template for new components (see `core/component_text_area/`).
- **Search logic:** See `core/search/class.search.php` for how search is implemented and how queries are constructed from ontology-driven descriptors.
- **API / Areas:** Area-based endpoints are under `core/api/` and `core/area_*` directories. Each `area` usually exposes a small `index.php`-style entry mapping requests to handlers.
- **Ontology:** `core/ontology/` and `core/ontology_engine/` hold the model and engine that build form definitions and runtime objects — changes here are high-impact. Prefer additive changes and avoid breaking the model contract.

Developer workflows & exact commands
- Install PHP deps (composer is used only for dev deps):
  - `composer install` (installs tools such as `phpunit`)
- Run unit tests (dev):
  - `vendor/bin/phpunit` (composer `require-dev` contains `phpunit/phpunit`)
- Build docs (local):
  - `mkdocs build` (see `mkdocs.yml`; requires `mkdocs` + `mkdocs-material`)

Runtime / platform notes
- Requires PHP 8.3+, PostgreSQL 16+ (see `Readme.md`). External OS tools often required for full feature set: FFmpeg, ImageMagick, `qt-faststart`, and Xpdf tools.
- Many features expect a running web server (Apache). For quick iterative work, run PHP's built-in server or use the project's recommended development VM described in `Readme.md`.

Project-specific conventions
- **Ontology-first:** Most UI and data structures are generated by reading ontology definitions at runtime. To change a form or field, prefer editing ontology definitions or `code/` files over scattering hand-written forms.
- **Component naming:** Component directories are named `component_<type>` and contain the component’s logic and templates. Copy an existing component and adapt its namespaced references.
- **Config-driven behavior:** Search for `DEDALO_ENTITY` and other defines in `config/config.php` — many runtime behaviors come from those constants.

Integration points & external dependencies
- Composer-managed dev tools under `vendor/` (see `composer.json`).
- Native OS dependencies (FFmpeg, ImageMagick) are required by media-processing code in `core/media_engine/` and related folders.

> Quick examples for small edits
>- To add a helper to search: update `core/search/class.search.php` and add tests under `test/` following the existing test structure.
>- To add a new component: copy `core/component_text_area/` → `core/component_my_new/`, update entry files, register via the Development Area after deployment.

Guidance for AI agents
- Make minimal, local changes and preserve the ontology contracts. Large changes to `core/ontology` or `ontology_engine` require coordination.
- Prefer searching for patterns (grep for `component_`, `class.search`, `DEDALO_ENTITY`) and follow an existing directory’s structure for new code.
- When in doubt, reference `Readme.md` and `mkdocs.yml` for install and runtime requirements, and ask for clarification if a change touches production initialization (install/update flows).

If any of these sections are unclear or you want more examples (e.g. a minimal component stub or test harness), tell me which area to expand and I will iterate.
